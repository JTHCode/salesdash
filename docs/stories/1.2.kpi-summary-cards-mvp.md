# Story 1.2: KPI Summary Cards MVP



## Status
Done


Ready for Review



## Story



**As a** hiring manager evaluating the demo,



**I want** KPI tiles showing revenue, profit margin, and growth with trend indicators,



**so that** I can quickly gauge the dashboard's ability to surface executive insights.



## Acceptance Criteria



1. KPI cards compute metrics from the static dataset and display formatted values.



2. Period-over-period deltas and directional arrows (up/down) render based on baseline comparison (e.g., previous period).



3. Cards update when date range inputs change (reusing placeholder controls for now).



4. Visual styling matches the UX vision (consistent colors, typography, responsive card layout).



## Dependencies



- Story 1.1: Streamlit Project Bootstrap provides the data loader, sidebar filters, and KPI component stub required for implementation (status Done).



## Project Structure Notes



- Keep KPI logic within `src/components/kpi_cards.py` and business calculations under `src/services/analytics_service.py` to respect the layered structure expected by downstream stories. [Source: architecture/source-tree.md#project-structure]



- Persist KPI unit tests in `tests/test_analytics.py` so regression coverage remains centralized for analytics services. [Source: architecture/source-tree.md#project-structure]



## Tasks / Subtasks



- [x] Build KPI calculation service functions (AC: 1, 2) [Source: architecture/core-services-implementation.md#2-analytics-service-analytics_servicepy]



  - [x] Implement `calculate_kpis` to compute revenue, profit, profit margin, order counts, and average order value from the filtered dataset. (AC: 1) [Source: architecture/core-services-implementation.md#2-analytics-service-analytics_servicepy]



  - [x] Extend period-over-period comparison logic to derive percentage deltas when a prior-period dataset exists, handling divide-by-zero safely. (AC: 2) [Source: architecture/core-services-implementation.md#2-analytics-service-analytics_servicepy]



  - [x] Ensure Streamlit caching wraps the KPI calculations so repeated filter changes stay performant. (AC: 1, 2) [Source: architecture/performance-optimization.md#caching-strategy]



- [x] Replace KPI placeholder component with production cards (AC: 1, 2, 4) [Source: architecture/visualization-components.md#kpi-cards-component-componentskpi_cardspy]



  - [x] Render four Streamlit metric cards with formatted values, percentage deltas, and built-in arrow indicators driven by KPI results. (AC: 1, 2) [Source: architecture/visualization-components.md#kpi-cards-component-componentskpi_cardspy]



  - [x] Apply the light theme colors and spacing defined for the dashboard when arranging the KPI columns to maintain design consistency. (AC: 4) [Source: architecture/deployment-configuration.md#streamlit-configuration-streamlitconfigtoml]



  - [x] Surface contextual captions or warnings when filters yield no data so the UX remains informative. (AC: 4) [Source: architecture/error-handling.md#example-error-handling-pattern]



- [x] Integrate KPI cards with filter-driven data flow (AC: 1, 3) [Source: architecture/streamlit-application-structure.md#main-app-apppy]



  - [x] Pass both filtered and full datasets to `kpi_cards.render` so baseline comparisons use the correct historical window. (AC: 2, 3) [Source: architecture/visualization-components.md#kpi-cards-component-componentskpi_cardspy]



  - [x] Confirm cards recompute automatically when date range, country, or status filters change by leveraging existing sidebar controls. (AC: 3) [Source: architecture/streamlit-application-structure.md#main-app-apppy]



  - [x] Update placeholder sidebar messaging to reflect completed KPI functionality while keeping future-story notes intact. (AC: 4) [Source: architecture/streamlit-application-structure.md#main-app-apppy]



- [x] Validate analytics behavior with automated and manual tests (AC: 1, 2, 3) [Source: architecture/testing-strategy.md#unit-tests-pytest]



  - [x] Add pytest coverage that exercises KPI calculations for positive, negative, and zero-baseline scenarios. (AC: 1, 2) [Source: architecture/testing-strategy.md#unit-tests-pytest]



  - [x] Document manual verification steps for date-range responsiveness and visual styling in the Testing section. (AC: 3, 4) [Source: architecture/testing-strategy.md#local-testing]



## Dev Notes



### Previous Story Insights



- Story 1.1 already initialised `kpi_cards.render(filtered, data)` inside `src/app.py`, so the new implementation should replace the placeholder while preserving the existing call signature that wires filtered data from sidebar controls. [Source: architecture/streamlit-application-structure.md#main-app-apppy]



### Data Models



- KPI computations rely on canonical sales fields such as `Sales`, `Total Profit/Loss`, `Quantity Ordered`, and `Order Date`, which the data loader standardises when generating CSV exports. [Source: architecture/data-architecture.md#data-model]



### API Specifications



- KPI logic executes in-process via `services.analytics_service.calculate_kpis` and related helpers; no external services are invoked, keeping interactions inside the Streamlit runtime. [Source: architecture/high-level-architecture.md#system-overview]



- The analytics service functions return dictionaries keyed by metric names for direct consumption by Streamlit components. [Source: architecture/core-services-implementation.md#2-analytics-service-analytics_servicepy]



### Component Specifications



- `components/kpi_cards.py` must call `calculate_kpis`, derive previous-period comparisons with `timedelta`, and display results through `st.metric` across four columns. [Source: architecture/visualization-components.md#kpi-cards-component-componentskpi_cardspy]



- When no rows match the filters, the component should warn the user instead of rendering stale metrics. [Source: architecture/visualization-components.md#kpi-cards-component-componentskpi_cardspy]



### File Locations



- Core analytics logic lives in `src/services/analytics_service.py`, while UI rendering remains in `src/components/kpi_cards.py` to keep presentation separate from computation. [Source: architecture/source-tree.md#project-structure]



- KPI-focused tests belong in `tests/test_analytics.py` alongside broader analytics coverage for consistency. [Source: architecture/source-tree.md#project-structure]



### Testing Requirements



- Implement pytest cases covering KPI sums, margins, and delta percentages in `tests/test_analytics.py`, following the architecture's unit testing guidance. [Source: architecture/testing-strategy.md#unit-tests-pytest]



- Include manual validation steps via `streamlit run src/app.py` to inspect card responsiveness and styling under varying filters. [Source: architecture/testing-strategy.md#local-testing]



### Technical Constraints



- Maintain compatibility with Python 3.11+, Streamlit 1.29+, and cached analytics routines to respect performance expectations. [Source: architecture/tech-stack.md#technology-stack]



- Use `@st.cache_data` on KPI computation paths to keep dashboard interactions performant during repeated filter changes. [Source: architecture/performance-optimization.md#caching-strategy]



- Apply theme colors and typography defined in `.streamlit/config.toml` so KPI cards stay visually aligned with the rest of the app. [Source: architecture/deployment-configuration.md#streamlit-configuration-streamlitconfigtoml]



## Testing



- Execute `pytest tests/test_analytics.py` to validate KPI aggregation and comparison edge cases introduced for this story. [Source: architecture/testing-strategy.md#unit-tests-pytest]



- Run `streamlit run src/app.py` and interact with date, country, and status filters to confirm KPI cards refresh metrics, show deltas, and maintain layout within the defined theme. [Source: architecture/testing-strategy.md#local-testing]



## Change Log



| Date       | Version | Description                     | Author |



|------------|---------|---------------------------------|--------|



| 2025-10-01 | v0.2    | KPI summary cards implementation ready for review | James (Dev Agent) |



| 2025-10-01 | v0.1    | Initial draft of Story 1.2      | Bob (Scrum Master) |



## Dev Agent Record



### Agent Model Used



OpenAI GPT-5 (Codex)



### Debug Log References



- `python -m pytest`



### Completion Notes List



- Implemented cached KPI analytics service powering revenue and profit metrics.



- Replaced KPI summary component with formatted Streamlit metrics and comparison messaging.



- Expanded analytics tests to cover baseline, delta, and empty dataset scenarios.



### File List



- src/services/analytics_service.py



- src/components/kpi_cards.py



- src/app.py



- tests/test_analytics.py



## QA Results

